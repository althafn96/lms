var L=Object.defineProperty;var F=Object.getOwnPropertySymbols;var P=Object.prototype.hasOwnProperty,K=Object.prototype.propertyIsEnumerable;var V=(c,r,n)=>r in c?L(c,r,{enumerable:!0,configurable:!0,writable:!0,value:n}):c[r]=n,b=(c,r)=>{for(var n in r||(r={}))P.call(r,n)&&V(c,n,r[n]);if(F)for(var n of F(r))K.call(r,n)&&V(c,n,r[n]);return c};import{u as G,U as O,y as l,N as B,a0 as Y,k as z,a7 as H,g as J,r as W,i as y,l as k,m as t,O as Q,n as x,p as w,q as h,F as U,v as X,P as N,Q as T,x as _}from"./vendor.9ac200cc.js";import{d as Z,a as I}from"./getCourse.117a78f9.js";import{u as ee,K as se,a as te}from"./app.52277fe1.js";import"./vue-multiselect.esm.f7127d48.js";import{v as oe}from"./useValidator.4107c1a7.js";import"./sweetalert2.1b53689f.js";import"./ckeditor.80e0daed.js";import"./getCategoriesToSelect.55e6b6b8.js";import"./getInstructorsToSelect.a6948607.js";import"./getLocationsToSelect.34aa23e1.js";import"./Bootstrap5.88c59918.js";const ie={class:"content d-flex flex-column flex-column-fluid",id:"kt_content"},ae={class:"container-xxl",id:"kt_content_container"},ne=["onSubmit"],le={class:"d-flex flex-column flex-row-fluid gap-7 gap-lg-10"},re={class:"d-flex flex-column gap-7 gap-lg-10"},ce={class:"nav nav-custom nav-tabs nav-line-tabs nav-line-tabs-2x border-0 fs-4 fw-bold mb-n2"},de={class:"nav-item"},ue=_("General"),pe={class:"nav-item"},fe=_("Modules"),_e={class:"nav-item"},he=_("FAQs"),me={class:"d-flex flex-column gap-7 gap-lg-10"},ve={class:"card card-flush py-4"},ge=t("div",{class:"card-header"},[t("div",{class:"card-title"},[t("h2",null,"FAQs")])],-1),be={class:"card-body pt-0"},ye={class:"fv-row"},ke=t("label",{class:"form-label"},"Question",-1),xe=["onUpdate:modelValue"],we={class:"fv-row"},Ee=t("label",{class:"form-label"},"Answer",-1),Ce=["onUpdate:modelValue"],qe={class:"mb-10 fv-row"},je=["onClick"],Ae=t("i",{class:"la la-trash-o fs-3"},null,-1),Fe=_("Delete "),Ve=[Ae,Fe],Be=t("i",{class:"la la-plus"},null,-1),Qe=_("Add "),Ue=[Be,Qe],Ne={class:"d-flex justify-content-end"},Te=t("span",{class:"indicator-label"},"Save Changes",-1),$e=t("span",{class:"indicator-progress"},[_("Please wait... "),t("span",{class:"spinner-border spinner-border-sm align-middle ms-2"})],-1),Me=[Te,$e],Ie={setup(c){const r=ee();r.title="Update Course FAQs",r.breadcrumbs=[{link:"/dashboard",title:"Dashboard"},{link:"/courses",title:"Courses"},{link:"",title:"Update Course"}];const n=G(),{result:m,loading:Se}=O(Z,{slug:n.currentRoute.value.params.slug},{fetchPolicy:"network-only"});let E=l(null),u=l(null),C=l(null),s=B({id:0,name:"",short_description:"",long_description:"",prerequisites:"",thumbnail:null,cover_img:null,status:1,is_featured:0,selected_categories:[],selected_skills:[],selected_instructors:[],selected_locations:[],categories:{sync:[]},instructors:{sync:[]},locations:{sync:[]},skills:{sync:[],create:[]},faqs:{sync:[],create:[],update:[]},modules:{update:[],delete:[],create:[]}});l(null),l(null),l([]);let i=B({});l([]),l([]),l([]),l([]);let f=l([]),v=l([]),q=l([]),j=l([]);const{resolveClient:$}=Y();$();const{mutate:M,onDone:De,onError:Re}=z(I),S=()=>{s.categories.sync=[],s.instructors.sync=[],s.locations.sync=[],s.skills.sync=[],s.skills.create=[],s.faqs.sync=[],s.faqs.create=[],s.faqs.update=[],s.modules.update=[],s.modules.create=[],f.value.length&&f.value.forEach(function(e,o){e.id==""?s.faqs.create.push({question:e.question,answer:e.answer}):(s.faqs.sync.push(e.id),s.faqs.update.push({id:e.id,question:e.question,answer:e.answer}))}),v.value.length&&v.value.forEach(function(e,o){if(e.id=="")s.modules.create.push({name:e.name,description:e.description,lessons:{create:e.lessons}});else{let d={create:[],update:[],delete:[]};e.lessons.forEach(function(a,g){if(a.id=="")d.create.push({title:a.title,description:a.description,period:a.period,files:{create:a.files.create}});else{let p=[];j.value.length&&j.value.forEach(function(A){A.lesson==a.id&&p.push(A.file)}),d.update.push({id:a.id,title:a.title,description:a.description,period:a.period,files:{delete:p,create:a.newFiles}})}}),q.value.length&&q.value.forEach(function(a){a.module==e.id&&d.delete.push(a.lesson)}),s.modules.update.push({id:e.id,name:e.name,description:e.description,lessons:d})}}),s.selected_categories.length&&s.selected_categories.forEach(function(e,o){s.categories.sync.push(e.id)}),s.selected_instructors.length&&s.selected_instructors.forEach(function(e,o){s.instructors.sync.push(e.id)}),s.selected_locations.length&&s.selected_locations.forEach(function(e,o){s.locations.sync.push(e.id)}),s.selected_skills.length&&s.selected_skills.forEach(function(e,o){isNaN(e.id)?s.skills.create.push({title:e.title}):s.skills.sync.push(e.id)}),C.validate().then(async function(e){if(e=="Valid"){u.value.setAttribute("data-kt-indicator","on"),u.value.disabled=!0;try{const o=await M(b({},s),{context:{hasUpload:!0}});alert("course updated successfully"),u.value.removeAttribute("data-kt-indicator"),u.value.disabled=!1}catch{alert("error occurred. please try again later."),u.value.removeAttribute("data-kt-indicator"),u.value.disabled=!1}}else alert("Sorry, looks like there are some errors detected, please try again.")})};H(()=>{if(m.value)if(!m.value.course)n.push("/categories");else{if(i=m.value.course,s.id=i.id,s.name=i.name,s.short_description=i.short_description,s.long_description=i.long_description,s.prerequisites=i.prerequisites,s.status=i.status?1:0,s.is_featured=i.is_featured?1:0,i.categories.length&&i.categories.forEach(function(e){s.selected_categories=[{id:e.id,name:e.name}]}),i.instructors.length){let e=[];i.instructors.forEach(function(o){e.push({id:o.id,name:o.full_name})}),s.selected_instructors=e}if(i.locations.length){let e=[];i.locations.forEach(function(o){e.push({id:o.id,name:o.name})}),s.selected_locations=e}if(i.skills.length){let e=[];i.skills.forEach(function(o){e.push({id:o.id,title:o.title})}),s.selected_skills=e}i.faqs.length&&i.faqs.forEach(function(e){f.value.push({question:e.question,answer:e.answer,id:e.id})}),i.modules.length&&i.modules.forEach(function(e){v.value.push({name:e.name,description:e.description,id:e.id,lessons:e.lessons.map(o=>b({},o))})})}});const D=()=>{f.value.push({id:"",question:"",answer:""})},R=e=>{confirm("Confirm to remove this FAQ. You cannot undo this action.")==!0&&f.value.splice(e,1)};return J(()=>{C=oe(E.value,{name:{validators:{notEmpty:{message:"Course Name is required"}}}}),se.init(),te.initButtons()}),(e,o)=>{const d=W("router-link");return y(),k("div",ie,[t("div",ae,[t("form",{onSubmit:Q(S,["prevent"]),ref_key:"form",ref:E,class:"form fv-plugins-bootstrap5 fv-plugins-framework d-flex flex-column flex-lg-row"},[t("div",le,[t("div",re,[t("ul",ce,[t("li",de,[x(d,{class:"nav-link text-active-primary pb-4",to:`/courses/edit/${h(n).currentRoute.value.params.slug}`},{default:w(()=>[ue]),_:1},8,["to"])]),t("li",pe,[x(d,{class:"nav-link text-active-primary pb-4",to:`/courses/edit/${h(n).currentRoute.value.params.slug}/modules`},{default:w(()=>[fe]),_:1},8,["to"])]),t("li",_e,[x(d,{class:"nav-link text-active-primary active pb-4",to:`/courses/edit/${h(n).currentRoute.value.params.slug}/faqs`},{default:w(()=>[he]),_:1},8,["to"])])]),t("div",me,[t("div",ve,[ge,t("div",be,[(y(!0),k(U,null,X(h(f),(a,g)=>(y(),k(U,{key:g},[t("div",ye,[ke,N(t("input",{"onUpdate:modelValue":p=>a.question=p,type:"text",name:"question",class:"form-control mb-2",placeholder:"Question"},null,8,xe),[[T,a.question]])]),t("div",we,[Ee,N(t("textarea",{"onUpdate:modelValue":p=>a.answer=p,name:"answer",class:"form-control mb-2",placeholder:"Answer"},null,8,Ce),[[T,a.answer]])]),t("div",qe,[t("a",{onClick:p=>R(g),href:"javascript:;",class:"btn btn-sm btn-light-danger mt-0"},Ve,8,je)])],64))),128)),t("div",{class:"fv-row"},[t("a",{onClick:D,href:"javascript:;",class:"btn btn-light-primary"},Ue)])])])])]),t("div",Ne,[t("button",{onClick:o[0]||(o[0]=Q(a=>h(n).go(-1),["prevent"])),id:"course_update_cancel",class:"btn btn-light me-5"},"Cancel"),t("button",{ref_key:"submitButton",ref:u,type:"submit",id:"submitButton",class:"btn btn-primary"},Me,512)])])],40,ne)])])}}};export{Ie as default};
